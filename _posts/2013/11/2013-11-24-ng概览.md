---
layout: post
title: AngularJS E2E
categories:
- programming
tag:
- AngularJS
---

本文主要是根据 ng 书的作者 Brad Green 的演讲PPT学习进行的一个笔记，应该讲是对 ng 的一个概览吧。凑会着看看大家。[PPT地址](http://vdisk.weibo.com/s/zrAFTGAVltFxz?sudaref=weibo.com)

## 用ng构建app：基本概念

### **Setup : Template**

    <html ng-app="coolApp">
    ...
    <body>
    ...
        <script src="angular.js"></script>
        <script src="coolApp.js"></script>
    </body>
    </html>
    
### **Setup : JS**

    var myApp = angular.module('coolApp', []);
    
### **原则**
主要有三个原则：

- D.R.Y. : Boilerplate
- Structure
- Testability

这其中呢，最重要的就是这个框架的结构了，可以用这条链来形容：*Model -- View -- Contrller* ，请看下面这张图：

![ngMVC](../../../media/image/ng-related/ngMVC.png)

从上图可以看出很清晰的关系：

- View：DOM对象，监听Model是否有变化，通知Controller这种变化
- Controller：JS Classes，从View处接收通知，对Model进行操作
- Model：JS Objects，受View的监听，受Controller的控制及操作

上面的Controller和Model对应了JS的两个概念，Classes 和 Objects ，要好好揣摩，具体可以参见：[这篇文章](http://www.kirupa.com/html5/objects_classes_javascript.htm)，另外还可以到stackoverflow上找到很多你要的答案。

下面就来看一个MVC代码片段的例子：

    // Model
    { 'name' : 'Misko' }
    
    // View
    <p ng-controller="PersonCtrl as person">
        Hi, { {person.model.name} }
    </p>

    // Controller
    myApp.controller('PersonCtrl', function() {
        this.model = { name : 'Misko'};
    });
    
一般情况下，其实 Model 的数据是被注册在 $scope 对象中的，和 Controller 是在同个js文件中的。

## ng的特点

### **数据绑定**
让我们看下面的代码：

    // hello.js 中
        this.greeting = 'Hola!';
        
    // hello.html 中
        { {greeter.greeting} }                  // 1-way binding
        <input ng-model="greeter.greeting" />   // 2-way binding
        
**需要注意**的是如果在页面的初次加载中使用绑定，需要避免加载未被css样式渲染的内容，看下面的几个例子：

    // 下面的 markup 表现没有问题，除了第一次加载
        <p>{ {someObj.sth} }</p>

    // 用 ng-cloak 避免在加载时有些内容不被样式化
        <p ng-cloak>{ {someObj.sth} }</p>
        
    // 用属性绑定的形式也可以避免上述情况
        <p ng-bind="someObj.sth"></p>

### **Directives**
先来看一下下面的代码片段，很simple的：

    <div ng-repeat="item in cart.items">
        <span ng-bind="item.name"></span>
        <button ng-click="cart.delete($index)">Delete</button>
    </div>

上面有三个指令，如果在它们前面都加上前缀 `data-` 的话，这样可以用来做 `directive validation` 验证指令的有效性，当然，一般情况下这是不必要的。

### **依赖注入**
首先是定义一个服务，可以是数据服务，操作服务等等，看一下下面的例子：

    // Definition
    function MyFoo() { ... };
    module.service('foo', MyFoo);
    
    // Usage
    function MyBar(foo) {
        Foo instanceof MyFoo; // true!
    }