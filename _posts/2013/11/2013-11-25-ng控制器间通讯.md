---
layout: post
title: ng中控制器间的通信
categories:
- programming
tag:
- AngularJS
---

本文主要是因为自己做项目过程中存在这样的需求：在controllers之间传递数据的需求，所以找呀找，好不容易找到这么篇文章，绝对要共享一下的。  
[AngularJS: Communication Between Controllers](http://elikirk.com/2013/07/22/angularjs-communication-between-controllers/)

在同个angular应用的控制器之间进行通信可以有很多种不同的方式，本文主要讲两种：

1. 基于scope继承的方式
2. 基于event传播的方式

## 基于scope继承
最简单的让控制器之间进行通信的方法是通过scope的继承。假设有两个控制器Parent、Child，Child 在 Parent 内，那Child 可以称为子控制器，它将继承父控制器Parent的scope。这样，Child就可以访问到Parent的scope中的所有函数和变量了。  
需要注意的是，由于scope的继承也是基于Js的原型继承，如果变量是基本类型的，那在Child中的修改（写），有可能会导致Parent中的数据变脏。

### 基本类型变量的继承

```javascript
function Sandcrawler($scope) {
    $scope.location = 'Mos Eisley North';
    $scope.move = function(newLocation) {
        $scope.location = newLocation;
    }
}

function Droid($scope) {
    $scope.sell = function(newLocation) {
        $scope.location = newLocation;
    }
}
// html
<div ng-controller="Sandcrawler">
    <p>Location: {{location}}</p>
    <button ng-click="move('Mos Eisley South')">Move</button>
    <div ng-controller="Droid">
        <p>Location: {{location}}</p>
        <button ng-click="sell('Owen Farm')">Sell</button>
    </div>
</div>
```

看完上面的代码我们知道，`location` 属性是直接被注册到 $scope 中的，Droid控制器所拥有的scope从Sandcrawler控制器的scope中继承了这个属性并且可以读取它。看以下两个假设场景：

- 如果 Sandcrawler 中改变了 `location` 属性，在 Droid 中也会读取到这个改变；在 view 中的表现则是：点击了 `Move` 按钮的话，两个 p 标签都会显示 `Mos Eisley South`
- 反过来，如果 Droid 中对 `$scope.location` 进行改写，它只改写自己scope中 `location` 属性的值，它不会影响 Sandcrawler 中的这个属性的值；在 view 中的表现则是：**当点击了 `Sell` 按钮之后，两个控制器scope之间的数据共享就不复存在了，之后无论点多少次 `Move` 按钮，都影响不了 Droid 中的 p 标签的显示了**

经过上面的教训，有时候我们想要达到的效果可能达不到（如点了 `Sell` 按钮之后再点 `Move` 还想让它起作用），这样在ng的开发者中逐渐达成了一个一致的约定，千万不要把那些可以被子级scope改写的属性用基础类型直接添加在 $scope 对象上，**而是应该尽可能地用对象类型去添加**。